{
  "name": "Stage 1 Content Discovery - FULLY FIXED",
  "nodes": [
    {
      "parameters": {},
      "id": "node-1",
      "name": "Manual Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        208,
        400
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 12
            }
          ]
        }
      },
      "id": "node-2",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        208,
        240
      ]
    },
    {
      "parameters": {
        "jsCode": "const subreddits = [\n  'Artificial',\n  'ArtificialInteligence',\n  'OpenAI',\n  'MachineLearning',\n  'singularity'\n];\n\nconst startUrls = [];\nfor (const sub of subreddits) {\n  startUrls.push({ url: `https://www.reddit.com/r/${sub}/top.json?t=day&limit=10` });\n}\n\nreturn [{ json: { startUrls } }];"
      },
      "id": "node-3",
      "name": "Generate Reddit URLs",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        400
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.apify.com/v2/acts/trudax~reddit-scraper-lite/run-sync-get-dataset-items?token={{ $env.APIFY_API_TOKEN }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ startUrls: $json.startUrls, maxItems: 50, skipComments: true, maxComments: 0, maxCommunitiesCount: 5, maxPostCount: 10, proxy: { useApifyProxy: true } }) }}",
        "options": {
          "allowUnauthorizedCerts": true,
          "timeout": 600000
        }
      },
      "id": "node-4",
      "name": "Fetch Reddit via Apify",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        672,
        400
      ],
      "onError": "continueRegular"
    },
    {
      "parameters": {
        "jsCode": "// Only filter by dataType=post â€” pass everything else through\nconst items = $input.all();\nconst processed = [];\nconst seenIds = new Set();\n\nfor (const item of items) {\n  let data = item.json || {};\n  const records = Array.isArray(data) ? data : [data];\n\n  for (const post of records) {\n    if (!post) continue;\n    if (post.dataType !== 'post') continue;\n\n    const postId = post.id || post.postId || '';\n    if (seenIds.has(postId)) continue;\n    seenIds.add(postId);\n\n    const title = post.title || '';\n    const body = post.body || post.selftext || '';\n    const content = title + (body ? '\\n\\n' + body : '');\n    const upvotes = post.upVotes || post.ups || post.score || 0;\n    const comments = post.numberOfComments || post.num_comments || post.commentsCount || 0;\n    const category = post.category || post.communityName?.replace('r/', '') || 'tech';\n    const isLinkPost = post.url && !post.url.includes('reddit.com') && !post.url.includes('redd.it');\n    const redditThreadUrl = post.permalink\n      ? (post.permalink.startsWith('http') ? post.permalink : 'https://reddit.com' + post.permalink)\n      : (post.url || `https://reddit.com/r/${category}`);\n    const externalUrl = isLinkPost ? post.url : redditThreadUrl;\n\n    processed.push({\n      json: {\n        post_id: postId,\n        platform: 'Reddit',\n        title: title,\n        content: content.substring(0, 1500),\n        body: body.substring(0, 800),\n        url: redditThreadUrl,\n        external_url: externalUrl,\n        is_news_link: isLinkPost || false,\n        domain: post.domain || 'reddit.com',\n        likes: upvotes,\n        comments: comments,\n        views: upvotes + comments,\n        engagement_score: upvotes + (comments * 2),\n        engagement_rate: ((upvotes / Math.max(upvotes + comments, 1)) * 100).toFixed(2),\n        category: category,\n        community_name: post.communityName || 'Reddit',\n        author: post.username || post.author || 'anon',\n        created_at: post.createdAt || post.created_utc || new Date().toISOString(),\n        data_type: post.dataType\n      }\n    });\n  }\n}\n\nconsole.log(`âœ… Found ${processed.length} posts (dataType=post only)`);\nreturn processed.length > 0 ? processed : [{ json: { _skip: true, platform: 'Reddit', reason: 'No posts found' } }];"
      },
      "id": "node-5",
      "name": "Parse Reddit Posts (News Only)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        400
      ],
      "onError": "continueRegular"
    },
    {
      "parameters": {
        "jsCode": "// Pass through ALL items â€” no filtering\nreturn $input.all();"
      },
      "id": "node-6",
      "name": "Remove Empty Items",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        400
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Analyze this Reddit post for viral potential and AI/ML/Tech relevance.\n\nTitle: {{ $json.title }}\nSubreddit: {{ $json.category }}\nUpvotes: {{ $json.likes }}\nComments: {{ $json.comments }}\nDomain: {{ $json.domain }}\nBody: {{ $json.body }}\n\nReturn ONLY a valid JSON object (no markdown, no backticks, no explanation) with these exact fields:\n{\"Viral_Score\": 0-100, \"Hook_Pattern\": \"pattern type\", \"Content_Structure\": \"breaking news or research paper or product launch or opinion or tutorial or controversy\", \"Emotional_Triggers\": \"emotions driving engagement\", \"Viral_Elements\": \"what makes it spread\", \"Script_Framework\": \"framework used\", \"is_ai_ml_tech\": true or false, \"news_relevance\": 0-100}",
        "batching": {
          "batchSize": 1
        }
      },
      "id": "node-7",
      "name": "Gemini Analyze News Post",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1296,
        400
      ],
      "onError": "continueRegular"
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "node-8",
      "name": "Gemini Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1296,
        560
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "igaSdthsiO1WHIs5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Build Airtable-ready output: original post data + Gemini analysis\n// Get original items from the Remove Empty Items node\nlet originals = [];\ntry { originals = $items('Remove Empty Items'); } catch(e) { originals = []; }\nconst geminiItems = $input.all();\nconst output = [];\n\nfor (let i = 0; i < geminiItems.length; i++) {\n  const gemini = geminiItems[i].json || {};\n  const orig = originals[i]?.json || {};\n\n  // Parse Gemini text response into JSON\n  const rawText = gemini.text || gemini.output || '{}';\n  let ai = {};\n  try {\n    ai = JSON.parse(rawText);\n  } catch (e) {\n    const match = rawText.match(/\\{[\\s\\S]*\\}/);\n    if (match) {\n      try { ai = JSON.parse(match[0]); } catch (e2) {}\n    }\n  }\n\n  const s = (v) => (v === undefined || v === null) ? '' : (typeof v === 'object' ? JSON.stringify(v) : String(v));\n  const title = orig.title || '';\n  const body = orig.body || '';\n\n  // Output fields matching Airtable Viral Content DB schema exactly\n  output.push({\n    json: {\n      Name: title.substring(0, 100),\n      Post_ID: orig.post_id || '',\n      Platform: orig.platform || 'Reddit',\n      Post_URL: orig.url || '',\n      Content: title + (body ? '\\n\\n' + body : ''),\n      Engagement_Score: orig.engagement_score || 0,\n      Likes_Reactions_Upvotes: orig.likes || 0,\n      Comments: orig.comments || 0,\n      Shares_Awards: 0,\n      Viral_Score: parseInt(ai.Viral_Score || ai.viral_score) || 0,\n      Hook_Pattern: s(ai.Hook_Pattern || ai.hook_pattern || ''),\n      Content_Structure: s(ai.Content_Structure || ai.content_structure || ''),\n      Emotional_Triggers: s(ai.Emotional_Triggers || ai.emotional_triggers || ''),\n      Viral_Elements: s(ai.Viral_Elements || ai.viral_elements || ''),\n      Script_Framework: s(ai.Script_Framework || ai.script_framework || ''),\n      Status: 'Generate Script',\n      Created_Date: new Date().toISOString().split('T')[0],\n      Script_Library: '',\n      Engagement_Rate: orig.engagement_rate || '0',\n      Followers: 0,\n      Saves: 0,\n      Shares: 0,\n      Impressions: orig.views || 0,\n      Clicks: 0,\n      Views: orig.views || 0,\n      Transcript: '',\n      // Keep these for the filter node\n      is_ai_ml_tech: ai.is_ai_ml_tech !== false,\n      news_relevance: parseInt(ai.news_relevance) || 0\n    }\n  });\n}\n\nconsole.log('Merged ' + output.length + ' posts with Gemini analysis for Airtable');\nreturn output.length > 0 ? output : [{ json: { _skip: true } }];"
      },
      "id": "node-9",
      "name": "Parse Gemini Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1504,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Pass through posts that are AI/ML/Tech relevant\nreturn $input.all().filter(item => {\n  const d = item.json;\n  if (d._skip) return false;\n  return d.is_ai_ml_tech === true || d.news_relevance >= 50 || d.Viral_Score >= 30;\n});"
      },
      "id": "node-filter-relevant",
      "name": "Filter Relevant News Only",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1712,
        400
      ]
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "={{ $env.AIRTABLE_BASE_ID }}",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "={{ $env.AT_TABLE_VIRAL_DB }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $json.Name }}",
            "Post_ID": "={{ $json.Post_ID }}",
            "Platform": "={{ $json.Platform }}",
            "Post_URL": "={{ $json.Post_URL }}",
            "Content": "={{ $json.Content }}",
            "Engagement_Score": "={{ $json.Engagement_Score }}",
            "Likes_Reactions_Upvotes": "={{ $json.Likes_Reactions_Upvotes }}",
            "Comments": "={{ $json.Comments }}",
            "Shares_Awards": "={{ $json.Shares_Awards }}",
            "Viral_Score": "={{ $json.Viral_Score }}",
            "Hook_Pattern": "={{ $json.Hook_Pattern }}",
            "Content_Structure": "={{ $json.Content_Structure }}",
            "Emotional_Triggers": "={{ $json.Emotional_Triggers }}",
            "Viral_Elements ": "={{ $json.Viral_Elements }}",
            "Script_Framework": "={{ $json.Script_Framework }}",
            "Status": "={{ $json.Status }}",
            "Created_Date": "={{ $json.Created_Date }}",
            "Script Library": "",
            "Engagement_Rate": "={{ $json.Engagement_Rate }}",
            "Followers": "=0",
            "Saves": "=0",
            "Shares": "=0",
            "Impressions": "={{ $json.Impressions }}",
            "Clicks": "=0",
            "Views": "={{ $json.Views }}",
            "Transcript": ""
          }
        },
        "options": {
          "typecast": true
        }
      },
      "id": "node-10",
      "name": "Store in Viral Content DB",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1920,
        400
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "h68hvDXg5Xigfz5P",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {},
      "id": "node-s2-trigger",
      "name": "Manual Trigger (Stage 2)",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        208,
        800
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 6
            }
          ]
        }
      },
      "id": "node-s2-schedule",
      "name": "Schedule Trigger (Every 6h)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        208,
        928
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "={{ $env.AIRTABLE_BASE_ID }}",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "={{ $env.AT_TABLE_VIRAL_DB }}",
          "mode": "id"
        },
        "options": {}
      },
      "id": "node-s2-read-db",
      "name": "Read Viral Content DB",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        448,
        864
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "h68hvDXg5Xigfz5P",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filter records with Status='Generate Script' and limit to 10\nreturn $input.all().filter(item => {\n  const status = item.json.Status || '';\n  return status === 'Generate Script';\n}).slice(0, 10);"
      },
      "id": "node-s2-filter",
      "name": "Filter Unprocessed Posts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        864
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Context and Author Profile:\nUjjwal Roy is the CEO of ScaleBuild AI, a custom AI software development company specializing in workflow automation, customer-facing tools, and AI model development. He also serves as CEO of Seethos AI (computer vision for manufacturing), Chair of IEEE Young Professionals, and founding president of the World AI Alliance. His background spans engineering roles at Intel, Micron, and IBM, as well as Wall Street finance. He is 32 years old.\n\nTask:\nRewrite the following news content as an original thought leadership post for Ujjwal's social media channels (primarily LinkedIn).\n\nTone and Voice Guidelines:\n- Direct and to the point. No fluff, no filler, no softening language. Say what you mean.\n- Position Ujjwal as a credible, forward-thinking voice in the AI industry who interprets what news means for the broader landscape\n- Reflect the perspective of a hands-on AI CEO who builds real products, not a passive observer\n- Confident and opinionated, but grounded with reasoning or real-world parallels\n- Conversational and punchy, not corporate or formal. Write like a 32-year-old founder talking to peers.\n- Avoid generic AI hype or surface-level commentary. Go deeper with strategic insight or contrarian angles.\n- The output must read like a real human wrote it. Use natural sentence rhythms, occasional imperfect phrasing, and varied sentence lengths. Avoid patterns that feel templated, overly polished, or AI-generated. No perfectly balanced sentence structures. No formulaic transitions. Write the way a smart, busy founder actually talks online.\n\nStructure and Length (STRICT):\n- Maximum two short paragraphs. No exceptions. Each paragraph should be 2 to 4 sentences.\n- Total word count: 50 to 100 words. Treat this as a hard ceiling.\n- The opening sentence must be a strong, creative hook. Not generic, not clickbait. It should be a sharp, original observation or a surprising reframe that makes people stop scrolling. Think of the kind of opener that makes someone say I never thought of it that way.\n- Close with a perspective, prediction, or question that invites engagement\n- Distill the news down to the single most important insight and build the entire post around that one idea. Cut everything else ruthlessly.\n- No bullet points, no numbered lists, no headers\n\nFormatting Rules:\n- Never use em dashes anywhere in the output. Use commas, periods, parentheses, or restructure the sentence instead.\n- No ellipses for dramatic effect\n- No hashtags unless specifically requested\n\nWhat to Avoid:\n- Do not summarize the full news story. Extract only the sharpest takeaway.\n- Do not use buzzwords without substance (e.g., revolutionary, game-changing)\n- Do not write in third person. Write as Ujjwal in first person.\n- Do not pad with filler sentences or repeat the same idea in different words\n- Do not use phrases that are commonly associated with AI-generated content (e.g., Lets dive in, Heres the thing, In todays rapidly evolving landscape, Its not just about X its about Y)\n- Do not open with a question as the hook. Lead with a statement.\n\nNews Content to Rewrite:\nTitle: {{ $json.Name }}\nContent: {{ $json.Content }}\nViral Score: {{ $json.Viral_Score }}\nHook Pattern: {{ $json.Hook_Pattern }}\nEmotional Triggers: {{ $json.Emotional_Triggers }}\nViral Elements: {{ $json.Viral_Elements }}\nScript Framework: {{ $json.Script_Framework }}\nEngagement Score: {{ $json.Engagement_Score }}\n\nReturn ONLY valid JSON (no markdown, no backticks, no explanation):\n{\"Script_Title\": \"LinkedIn - [Topic]\", \"Hook\": \"Sharp opening statement\", \"Main_Content\": \"2 paragraphs max 50-100 words\", \"CTA\": \"Perspective prediction or question\", \"Target_Platforms\": \"LinkedIn\", \"Tone\": \"Professional, strategic, insider perspective\", \"Hashtags\": \"\"}",
        "batching": {
          "batchSize": 1
        }
      },
      "id": "node-s2-gemini-prompt",
      "name": "Gemini Generate Social Scripts",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        864,
        864
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Context and Author Profile:\nUjjwal Roy is the CEO of ScaleBuild AI, a custom AI software development company specializing in workflow automation, customer-facing tools, and AI model development. He also serves as CEO of Seethos AI (computer vision for manufacturing), Chair of IEEE Young Professionals, and founding president of the World AI Alliance. His background spans engineering roles at Intel, Micron, and IBM, as well as Wall Street finance. He is 32 years old.\n\nTask:\nRewrite the following news content as an original thought leadership post for Ujjwal's social media channels (primarily Twitter/X).\n\nTone and Voice Guidelines:\n- Direct and to the point. No fluff, no filler, no softening language. Say what you mean.\n- Position Ujjwal as a credible, forward-thinking voice in the AI industry who interprets what news means for the broader landscape\n- Reflect the perspective of a hands-on AI CEO who builds real products, not a passive observer\n- Confident and opinionated, but grounded with reasoning or real-world parallels\n- Conversational and punchy, not corporate or formal. Write like a 32-year-old founder talking to peers.\n- Avoid generic AI hype or surface-level commentary. Go deeper with strategic insight or contrarian angles.\n- The output must read like a real human wrote it. Use natural sentence rhythms, occasional imperfect phrasing, and varied sentence lengths. Avoid patterns that feel templated, overly polished, or AI-generated. No perfectly balanced sentence structures. No formulaic transitions. Write the way a smart, busy founder actually talks online.\n\nStructure and Length (STRICT):\n- Maximum two short paragraphs. No exceptions. Each paragraph should be 2 to 4 sentences.\n- Total word count: 50 to 100 words. Treat this as a hard ceiling.\n- The opening sentence must be a strong, creative hook. Not generic, not clickbait. It should be a sharp, original observation or a surprising reframe that makes people stop scrolling. Think of the kind of opener that makes someone say I never thought of it that way.\n- Close with a perspective, prediction, or question that invites engagement\n- Distill the news down to the single most important insight and build the entire post around that one idea. Cut everything else ruthlessly.\n- No bullet points, no numbered lists, no headers\n\nFormatting Rules:\n- Never use em dashes anywhere in the output. Use commas, periods, parentheses, or restructure the sentence instead.\n- No ellipses for dramatic effect\n- No hashtags unless specifically requested\n\nWhat to Avoid:\n- Do not summarize the full news story. Extract only the sharpest takeaway.\n- Do not use buzzwords without substance (e.g., revolutionary, game-changing)\n- Do not write in third person. Write as Ujjwal in first person.\n- Do not pad with filler sentences or repeat the same idea in different words\n- Do not use phrases that are commonly associated with AI-generated content (e.g., Lets dive in, Heres the thing, In todays rapidly evolving landscape, Its not just about X its about Y)\n- Do not open with a question as the hook. Lead with a statement.\n\nNews Content to Rewrite:\nTitle: {{ $json.Name }}\nContent: {{ $json.Content }}\nViral Score: {{ $json.Viral_Score }}\nHook Pattern: {{ $json.Hook_Pattern }}\nEmotional Triggers: {{ $json.Emotional_Triggers }}\nViral Elements: {{ $json.Viral_Elements }}\nScript Framework: {{ $json.Script_Framework }}\nEngagement Score: {{ $json.Engagement_Score }}\n\nReturn ONLY valid JSON (no markdown, no backticks, no explanation):\n{\"Script_Title\": \"Twitter/X - [Topic]\", \"Hook\": \"Sharp opening statement\", \"Main_Content\": \"2 paragraphs max 50-100 words\", \"CTA\": \"Perspective prediction or question\", \"Target_Platforms\": \"Twitter/X\", \"Tone\": \"Direct, opinionated, insider perspective\", \"Hashtags\": \"\"}",
        "batching": {
          "batchSize": 1
        }
      },
      "id": "node-s2-gemini-prompt-twitter",
      "name": "Gemini Generate Script - Twitter/X",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        864,
        912
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "Context and Author Profile:\nUjjwal Roy is the CEO of ScaleBuild AI, a custom AI software development company specializing in workflow automation, customer-facing tools, and AI model development. He also serves as CEO of Seethos AI (computer vision for manufacturing), Chair of IEEE Young Professionals, and founding president of the World AI Alliance. His background spans engineering roles at Intel, Micron, and IBM, as well as Wall Street finance. He is 32 years old.\n\nTask:\nRewrite the following news content as an original thought leadership post for Ujjwal's social media channels (primarily Facebook).\n\nTone and Voice Guidelines:\n- Direct and to the point. No fluff, no filler, no softening language. Say what you mean.\n- Position Ujjwal as a credible, forward-thinking voice in the AI industry who interprets what news means for the broader landscape\n- Reflect the perspective of a hands-on AI CEO who builds real products, not a passive observer\n- Confident and opinionated, but grounded with reasoning or real-world parallels\n- Conversational and punchy, not corporate or formal. Write like a 32-year-old founder talking to peers.\n- Avoid generic AI hype or surface-level commentary. Go deeper with strategic insight or contrarian angles.\n- The output must read like a real human wrote it. Use natural sentence rhythms, occasional imperfect phrasing, and varied sentence lengths. Avoid patterns that feel templated, overly polished, or AI-generated. No perfectly balanced sentence structures. No formulaic transitions. Write the way a smart, busy founder actually talks online.\n\nStructure and Length (STRICT):\n- Maximum two short paragraphs. No exceptions. Each paragraph should be 2 to 4 sentences.\n- Total word count: 50 to 100 words. Treat this as a hard ceiling.\n- The opening sentence must be a strong, creative hook. Not generic, not clickbait. It should be a sharp, original observation or a surprising reframe that makes people stop scrolling. Think of the kind of opener that makes someone say I never thought of it that way.\n- Close with a perspective, prediction, or question that invites engagement\n- Distill the news down to the single most important insight and build the entire post around that one idea. Cut everything else ruthlessly.\n- No bullet points, no numbered lists, no headers\n\nFormatting Rules:\n- Never use em dashes anywhere in the output. Use commas, periods, parentheses, or restructure the sentence instead.\n- No ellipses for dramatic effect\n- No hashtags unless specifically requested\n\nWhat to Avoid:\n- Do not summarize the full news story. Extract only the sharpest takeaway.\n- Do not use buzzwords without substance (e.g., revolutionary, game-changing)\n- Do not write in third person. Write as Ujjwal in first person.\n- Do not pad with filler sentences or repeat the same idea in different words\n- Do not use phrases that are commonly associated with AI-generated content (e.g., Lets dive in, Heres the thing, In todays rapidly evolving landscape, Its not just about X its about Y)\n- Do not open with a question as the hook. Lead with a statement.\n\nNews Content to Rewrite:\nTitle: {{ $json.Name }}\nContent: {{ $json.Content }}\nViral Score: {{ $json.Viral_Score }}\nHook Pattern: {{ $json.Hook_Pattern }}\nEmotional Triggers: {{ $json.Emotional_Triggers }}\nViral Elements: {{ $json.Viral_Elements }}\nScript Framework: {{ $json.Script_Framework }}\nEngagement Score: {{ $json.Engagement_Score }}\n\nReturn ONLY valid JSON (no markdown, no backticks, no explanation):\n{\"Script_Title\": \"Facebook - [Topic]\", \"Hook\": \"Sharp opening statement\", \"Main_Content\": \"2 paragraphs max 50-100 words\", \"CTA\": \"Perspective prediction or question\", \"Target_Platforms\": \"Facebook\", \"Tone\": \"Accessible, direct, hands-on founder\", \"Hashtags\": \"\"}",
        "batching": {
          "batchSize": 1
        }
      },
      "id": "node-s2-gemini-prompt-facebook",
      "name": "Gemini Generate Script - Facebook",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        864,
        944
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "node-s2-gemini-model",
      "name": "Gemini Model (Stage 2)",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        864,
        1024
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "igaSdthsiO1WHIs5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Parse Gemini outputs from 3 parallel platforms (LinkedIn, Twitter/X, Facebook)\n// âœ… DEBUG: Log all incoming data to diagnose platform issues\nconst geminiItems = $input.all();\nconsole.log(`ðŸ“¥ PARSE NODE: Received ${geminiItems.length} items from Gemini nodes`);\n\n// Log each platform's data\ngeminiItems.forEach((item, idx) => {\n  const platform = item.json?.Target_Platforms || item.json?.platform || 'Unknown';\n  const hasText = !!item.json?.text;\n  const hasTitle = !!item.json?.Script_Title;\n  console.log(`  [${idx}] Platform: ${platform} | Has text: ${hasText} | Has title: ${hasTitle}`);\n});\n\nconst output = [];\n\nfor (const item of geminiItems) {\n  let rawJson = item.json || {};\n  \n  // If Gemini returned as 'text' field, parse JSON from it\n  if (rawJson.text && typeof rawJson.text === 'string') {\n    try {\n      rawJson = JSON.parse(rawJson.text);\n    } catch (e) {\n      // Try to extract JSON object from text\n      const match = rawJson.text.match(/\\{[\\s\\S]*\\}/);\n      if (match) {\n        try { rawJson = JSON.parse(match[0]); } catch (e2) {\n          console.log('âŒ Failed to parse Gemini response:', rawJson.text.substring(0, 200));\n          continue;\n        }\n      } else {\n        console.log('âŒ No JSON found in Gemini text response');\n        continue;\n      }\n    }\n  }\n  \n  // If somehow it's still an array, take first element\n  if (Array.isArray(rawJson)) rawJson = rawJson[0] || {};\n  \n  const s = (val) => (val === undefined || val === null) ? '' : (typeof val === 'object' ? JSON.stringify(val) : String(val));\n  \n  output.push({\n    json: {\n      // Script Library fields\n      Name: s(rawJson.Script_Title || ''),\n      Source_Content_ID: '',\n      Script_Title: s(rawJson.Script_Title || ''),\n      Hook: s(rawJson.Hook || ''),\n      Main_Content: s(rawJson.Main_Content || ''),\n      CTA: s(rawJson.CTA || ''),\n      Visual_Cues: s(rawJson.Visual_Cues || ''),\n      Tone: s(rawJson.Tone || ''),\n      Hashtags: s(rawJson.Hashtags || ''),\n      Estimated_Duration: s(rawJson.Estimated_Duration || ''),\n      Target_Platforms: s(rawJson.Target_Platforms || ''),\n      Status: 'Draft',\n      Feedback: '',\n      Created_Date: new Date().toISOString(),\n      Video_Production_Queue: 'pending',\n      Video_RENDERS: ''\n    }\n  });\n}\n\nconsole.log(`âœ… Generated ${output.length} social media scripts from all platforms`);\nif (output.length !== geminiItems.length) {\n  console.log(`âš ï¸  WARNING: Expected ${geminiItems.length} outputs but got ${output.length}`);\n}\nreturn output.length > 0 ? output : [{ json: { _skip: true, reason: 'No scripts generated' } }];"
      },
      "id": "node-s2-parse-scripts",
      "name": "Parse Gemini Scripts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        864
      ]
    },
    {
      "parameters": {
        "jsCode": "// Remove failed/empty script records\nreturn $input.all().filter(item => {\n  return !item.json._skip && item.json.Script_Title;\n});"
      },
      "id": "node-s2-remove-empty",
      "name": "Remove Empty Scripts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1280,
        864
      ]
    },
    {
      "parameters": {
        "operation": "create",
        "base": {
          "__rl": true,
          "value": "={{ $env.AIRTABLE_BASE_ID }}",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "={{ $env.AT_TABLE_SCRIPT_LIB }}",
          "mode": "id"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Name": "={{ $json.Name }}",
            "Source_Content_ID": "={{ $json.Source_Content_ID }}",
            "Script_Title": "={{ $json.Script_Title }}",
            "Hook": "={{ $json.Hook }}",
            "Main_Content": "={{ $json.Main_Content }}",
            "CTA ": "={{ $json.CTA }}",
            "Visual_Cues": "={{ $json.Visual_Cues }}",
            "Tone": "={{ $json.Tone }}",
            "Hashtags": "={{ $json.Hashtags }}",
            "Estimated_Duration": "={{ $json.Estimated_Duration }}",
            "Status": "Draft",
            "Feedback": "",
            "Created_Date": "={{ $now.format('yyyy-MM-dd') }}",
            "Video Production Queue": "pending",
            "Video RENDERS": "",
            "Target_Platforms": "={{ $json.Target_Platforms }}"
          }
        },
        "options": {
          "typecast": true
        }
      },
      "id": "node-s2-store-scripts",
      "name": "Store in Script Library",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        1488,
        864
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "h68hvDXg5Xigfz5P",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {},
      "id": "node-s3-trigger",
      "name": "Manual Trigger (Stage 3)",
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -192,
        1552
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 4
            }
          ]
        }
      },
      "id": "node-s3-schedule",
      "name": "Schedule Trigger (Every 4h)",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        32,
        1696
      ]
    },
    {
      "parameters": {
        "operation": "search",
        "base": {
          "__rl": true,
          "value": "={{ $env.AIRTABLE_BASE_ID }}",
          "mode": "id"
        },
        "table": {
          "__rl": true,
          "value": "={{ $env.AT_TABLE_SCRIPT_LIB }}",
          "mode": "id"
        },
        "options": {}
      },
      "id": "node-s3-read-approved",
      "name": "Read Approved Scripts",
      "type": "n8n-nodes-base.airtable",
      "typeVersion": 2.1,
      "position": [
        256,
        1616
      ],
      "credentials": {
        "airtableTokenApi": {
          "id": "h68hvDXg5Xigfz5P",
          "name": "Airtable Personal Access Token account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Filter for Status = 'Approved' and parse Target_Platforms (multi-select field)\nconst approved = $input.all().filter(item => {\n  const status = item.json.Status || '';\n  return status.trim() === 'Approved';\n});\n\nconsole.log(`âœ… Found ${approved.length} approved scripts`);\n\nreturn approved.map((item, idx) => {\n  // Target_Platforms can be:\n  // 1. Array of strings: ['LinkedIn', 'Twitter/X']\n  // 2. Array of objects: [{id, email, name: 'LinkedIn'}, ...]\n  // 3. String (comma-separated): 'LinkedIn, Twitter/X'\n  let platformData = item.json['Target_Platforms '] || [];\n  \n  let platforms = [];\n  if (Array.isArray(platformData)) {\n    // Handle both array of strings and array of objects\n    platforms = platformData.map(p => {\n      if (typeof p === 'string') return p;\n      if (typeof p === 'object' && p.name) return p.name;\n      return p;\n    }).filter(p => p);\n  } else if (typeof platformData === 'string') {\n    // Handle comma-separated string\n    platforms = platformData.split(',').map(p => p.trim()).filter(p => p);\n  }\n  \n  console.log(`  Script: ${item.json.Script_Title} | Platforms: [${platforms.join(', ')}]`);\n  \n  return {\n    json: {\n      ...item.json,\n      _index: idx,\n      _platforms: platforms\n    }\n  };\n});"
      },
      "id": "node-s3-filter-approved",
      "name": "Filter Approved Status",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        1616
      ]
    },
    {
      "parameters": {
        "jsCode": "// Split approved scripts by platform for parallel posting\nconst output = [];\nconst platformMap = {\n  'linkedin': 'linkedin',\n  'twitter/x': 'twitter/x',\n  'twitter': 'twitter/x',\n  'x': 'twitter/x',\n  'facebook': 'facebook',\n  'reddit': 'reddit'\n};\n\nfor (const item of $input.all()) {\n  const platforms = item.json._platforms || [];\n  console.log(`ðŸ“‹ Processing: ${item.json.Script_Title} | Platforms: [${platforms.join(', ')}]`);\n  \n  // If no specific platforms, skip with warning\n  if (!platforms.length) {\n    console.log(`âš ï¸  No platforms found for ${item.json.Script_Title}`);\n    continue;\n  }\n  \n  // Create one output per platform this script targets\n  for (const platform of platforms) {\n    const normalizedPlatform = platformMap[platform.toLowerCase()] || platform.toLowerCase();\n    output.push({\n      json: {\n        ...item.json,\n        _targetPlatform: normalizedPlatform\n      }\n    });\n  }\n}\n\nconsole.log(`ðŸ“¤ TOTAL: Routing ${output.length} scripts to ${new Set(output.map(o => o.json._targetPlatform)).size} platforms`);\noutput.forEach(o => {\n  console.log(`  â†’ ${o.json.Script_Title} â†’ ${o.json._targetPlatform}`);\n});\n\nif (output.length === 0) {\n  console.log(`âŒ No scripts to route!`);\n}\nreturn output.length > 0 ? output : [{ json: { _skip: true } }];"
      },
      "id": "node-s3-route-platforms",
      "name": "Route by Platform",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        528,
        1616
      ]
    },
    {
      "parameters": {
        "jsCode": "// Debug: Check what's being passed to Switch\nconst items = $input.all();\nconsole.log(`ðŸ”€ SWITCH DEBUG: Received ${items.length} items`);\nitems.forEach((item, idx) => {\n  console.log(`  [${idx}] _targetPlatform = '${item.json._targetPlatform}' (type: ${typeof item.json._targetPlatform})`);\n});\nreturn items;"
      },
      "id": "node-s3-debug-switch",
      "name": "DEBUG: Before Switch",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        688,
        1616
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.linkedin.com/v2/ugcPosts",
        "authentication": "oAuth2",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "node-s3-post-linkedin",
      "name": "Post to LinkedIn",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1328,
        2000
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://graph.facebook.com/v20.0/{{ $env.FACEBOOK_PAGE_ID }}/feed",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "message",
              "value": "={{ $json.Hook }}\\n\\n{{ $json.Main_Content }}\\n\\n{{ $json.CTA }}"
            },
            {
              "name": "access_token",
              "value": "={{ $env.FACEBOOK_PAGE_ACCESS_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "id": "node-s3-post-facebook",
      "name": "Post to Facebook",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1328,
        1152
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.twitter.com/2/tweets",
        "authentication": "oAuth2",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {}
          ]
        },
        "options": {}
      },
      "id": "node-s3-post-twitter",
      "name": "Post to Twitter/X",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1296,
        1840
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://www.reddit.com/api/submit",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "oAuth2Api",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "api_type",
              "value": "json"
            },
            {
              "name": "kind",
              "value": "self"
            },
            {
              "name": "subreddit",
              "value": "={{ $json.Reddit_Subreddit || 'reddit' }}"
            },
            {
              "name": "title",
              "value": "={{ $json.Script_Title }}"
            },
            {
              "name": "text",
              "value": "={{ $json.Main_Content }}\n\n---\n**CTA:** {{ $json.CTA }}\n\n*Hook:* {{ $json.Hook }}"
            }
          ]
        },
        "options": {}
      },
      "id": "node-s3-post-reddit",
      "name": "Post to Reddit",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        1328,
        1360
      ],
      "credentials": {
        "oAuth2Api": {
          "id": "6Or7ukPXmVrFoAU9",
          "name": "Unnamed credential"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [],
          "dateTime": [],
          "number": [],
          "string": [
            {
              "value1": "={{ $json._targetPlatform }}",
              "operation": "equal",
              "value2": "linkedin"
            }
          ]
        }
      },
      "id": "node-s3-if-linkedin",
      "name": "IF LinkedIn",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        900,
        1808
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [],
          "dateTime": [],
          "number": [],
          "string": [
            {
              "value1": "={{ $json._targetPlatform }}",
              "operation": "equal",
              "value2": "facebook"
            }
          ]
        }
      },
      "id": "node-s3-if-facebook",
      "name": "IF Facebook",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        900,
        1312
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [],
          "dateTime": [],
          "number": [],
          "string": [
            {
              "value1": "={{ $json._targetPlatform }}",
              "operation": "equal",
              "value2": "twitter/x"
            }
          ]
        }
      },
      "id": "node-s3-if-twitter",
      "name": "IF Twitter/X",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        900,
        1632
      ]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [],
          "dateTime": [],
          "number": [],
          "string": [
            {
              "value1": "={{ $json._targetPlatform }}",
              "operation": "equal",
              "value2": "reddit"
            }
          ]
        }
      },
      "id": "node-s3-if-reddit",
      "name": "IF Reddit",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        900,
        1456
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Manual Trigger": {
      "main": [
        [
          {
            "node": "Generate Reddit URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Generate Reddit URLs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Reddit URLs": {
      "main": [
        [
          {
            "node": "Fetch Reddit via Apify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Reddit via Apify": {
      "main": [
        [
          {
            "node": "Parse Reddit Posts (News Only)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Reddit Posts (News Only)": {
      "main": [
        [
          {
            "node": "Remove Empty Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Empty Items": {
      "main": [
        [
          {
            "node": "Gemini Analyze News Post",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Analyze News Post",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Analyze News Post": {
      "main": [
        [
          {
            "node": "Parse Gemini Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Gemini Results": {
      "main": [
        [
          {
            "node": "Filter Relevant News Only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Relevant News Only": {
      "main": [
        [
          {
            "node": "Store in Viral Content DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store in Viral Content DB": {
      "main": [
        []
      ]
    },
    "Manual Trigger (Stage 2)": {
      "main": [
        [
          {
            "node": "Read Viral Content DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger (Every 6h)": {
      "main": [
        [
          {
            "node": "Read Viral Content DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Viral Content DB": {
      "main": [
        [
          {
            "node": "Filter Unprocessed Posts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Unprocessed Posts": {
      "main": [
        [
          {
            "node": "Gemini Generate Social Scripts",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Generate Script - Twitter/X",
            "type": "main",
            "index": 0
          },
          {
            "node": "Gemini Generate Script - Facebook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Model (Stage 2)": {
      "ai_languageModel": [
        [
          {
            "node": "Gemini Generate Social Scripts",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Gemini Generate Script - Twitter/X",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "Gemini Generate Script - Facebook",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Generate Social Scripts": {
      "main": [
        [
          {
            "node": "Parse Gemini Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Generate Script - Twitter/X": {
      "main": [
        [
          {
            "node": "Parse Gemini Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini Generate Script - Facebook": {
      "main": [
        [
          {
            "node": "Parse Gemini Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Gemini Scripts": {
      "main": [
        [
          {
            "node": "Remove Empty Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Empty Scripts": {
      "main": [
        [
          {
            "node": "Store in Script Library",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store in Script Library": {
      "main": [
        []
      ]
    },
    "Manual Trigger (Stage 3)": {
      "main": [
        [
          {
            "node": "Read Approved Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger (Every 4h)": {
      "main": [
        [
          {
            "node": "Read Approved Scripts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Approved Scripts": {
      "main": [
        [
          {
            "node": "Filter Approved Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Approved Status": {
      "main": [
        [
          {
            "node": "Route by Platform",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Platform": {
      "main": [
        [
          {
            "node": "DEBUG: Before Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "DEBUG: Before Switch": {
      "main": [
        [
          {
            "node": "IF LinkedIn",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Facebook",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Twitter/X",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Reddit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF LinkedIn": {
      "main": [
        [
          {
            "node": "Post to LinkedIn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Facebook": {
      "main": [
        [
          {
            "node": "Post to Facebook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Twitter/X": {
      "main": [
        [
          {
            "node": "Post to Twitter/X",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Reddit": {
      "main": [
        [
          {
            "node": "Post to Reddit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false
  },
  "versionId": "cbe9a13b-d86a-4234-993d-820e1fc898fe",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "dc87f94e8f44b5018e54a588eebeaae61eebdb6c256f8f2f61b7c6ba347bca63"
  },
  "id": "0ZSLiDZcYmBRLfgI",
  "tags": []
}